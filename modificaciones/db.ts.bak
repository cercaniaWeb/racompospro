import Dexie, { Table } from 'dexie';

// Interfaces basadas en tu esquema SQL pero para uso local
export interface ProductLocal {
  id: string; // UUID de Supabase
  name: string;
  price: number;
  sku: string;
  category_id: string;
  image_url?: string;
  is_weighted: boolean; // Importante para la báscula
  stock_local: number; // Stock sincronizado
}

export interface CartItem {
  product_id: string;
  name: string;
  price: number;
  quantity: number; // Puede ser decimal (0.500 kg)
  subtotal: number;
  is_weighted: boolean;
}

export interface SaleLocal {
  id?: number; // Auto-increment local
  uuid?: string; // UUID final para Supabase
  items: CartItem[];
  total: number;
  payment_method: 'cash' | 'card';
  status: 'pending' | 'synced'; // Clave para la sincronización
  created_at: Date;
}

class RecoomPOSDB extends Dexie {
  products!: Table<ProductLocal>;
  sales!: Table<SaleLocal>;

  constructor() {
    super('RecoomPOS_DB');
    
    // Definición de esquemas (solo campos indexados)
    this.version(1).stores({
      products: 'id, sku, name, category_id', // Índices para búsqueda rápida
      sales: '++id, status, created_at' // Índices para sync
    });
  }
}

export const db = new RecoomPOSDB();
